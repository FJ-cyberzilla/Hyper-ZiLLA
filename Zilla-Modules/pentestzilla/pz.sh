#!/bin/bash

# PentestZilla Unified Launcher

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

show_banner() {
    echo -e "${RED}""${RED}"
    echo -e "${RED}_______________________________________ ${RED}"
    echo -e "${RED} ▀▀█░▀█▀░█░░░█░░░█▀█░█▀█░█▀█░▀█▀░█▀▀░▀█▀ ${RED}"
    echo -e "${RED}░▄▀░░░█░░█░░░█░░░█▀█░█▀▀░█░█░░█░░▀▀█░░█░${RED}"
    echo -e "${RED}░▀▀▀░▀▀▀░▀▀▀░▀▀▀░▀░▀░▀░░░▀░▀░░▀░░▀▀▀░░▀░ ${RED}"
    echo -e "${GREEN}                         Unified v1.0${GREEN}"
}

main_menu() {
    show_banner
    echo -e "${CYAN}╔══════════════════════════════════════════════════════════╗${NC}"
    echo -e "${CYAN}║                         MAIN MENU                        ║${NC}"
    echo -e "${CYAN}╠══════════════════════════════════════════════════════════╣${NC}"
    echo -e "${CYAN}║                                                          ║${NC}"
    echo -e "${CYAN}║  ${GREEN}1${NC}${CYAN} »   PentZilla (Stable Scanner)    ║${NC}"
    echo -e "${CYAN}║  ${GREEN}2${NC}${CYAN} »  (AI/Blockchain/Experi)         ║${NC}"
    echo -e "${CYAN}║  ${GREEN}3${NC}${CYAN} »  (Go Network/Mobile Recon)      ║${NC}"
    echo -e "${CYAN}║  ${GREEN}4${NC}${CYAN} »   (Bluetooth HID Security)      ║${NC}"
    echo -e "${CYAN}║  ${GREEN}5${NC}${CYAN} »   Build/Rebuild All Modules     ║${NC}"
    echo -e "${CYAN}║  ${GREEN}6${NC}${CYAN} »   Exit                          ║${NC}"
    echo -e "${CYAN}║                                                          ║${NC}"
    echo -e "${CYAN}╚══════════════════════════════════════════════════════════╝${NC}"
    echo
    echo -ne "${YELLOW}Choice: ${NC}"
    read choice
}

run_pentestzilla() {
    local args="${@}"
    if [ ! -f "bin/pentestzilla" ]; then
        echo -e "${RED}[!] Binary not found. Building...${NC}"
        make pentestzilla
        if [ $? -ne 0 ]; then
            echo -e "${RED}[!] Build failed. Cannot run.${NC}"
            return 1
        fi
    fi
    ./bin/pentestzilla $args
}

run_pentestzilla_v4() {
    local args="${@}"
    if [ ! -f "bin/pentestzilla_v4" ]; then
        echo -e "${RED}[!] Binary not found. Building...${NC}"
        make pentestzilla_v4
        if [ $? -ne 0 ]; then
            echo -e "${RED}[!] Build failed. Cannot run.${NC}"
            return 1
        fi
    fi
    ./bin/pentestzilla_v4 $args
}

run_zillabreath() {
    local args="${@}"
    if [ ! -f "bin/zillabreath" ]; then
        echo -e "${RED}[!] Binary not found. Building...${NC}"
        make zillabreath
        if [ $? -ne 0 ]; then
            echo -e "${RED}[!] Build failed. Cannot run.${NC}"
            return 1
        fi
    fi
    ./bin/zillabreath $args
}

# run_zillatooth() {
#     local args="${@}"
#     if [ ! -f "bin/zillatooth" ]; then
#         echo -e "${RED}[!] Binary not found. Building...${NC}"
#         make zillatooth
#         if [ $? -ne 0 ]; then
#             echo -e "${RED}[!] Build failed. Cannot run.${NC}"
#             echo -e "${RED}[!] ZillaTooth requires libbluetooth development headers. It may not compile on all systems.${NC}"
#             read -p "Press Enter to return..."
#             return 1
#         fi
#     fi
#     if [ -f "bin/zillatooth" ]; then
#         ./bin/zillatooth $args
#     else
#         echo -e "${RED}[!] Failed to run ZillaTooth. Check missing dependencies (libbluetooth).${NC}"
#         read -p "Press Enter to return..."
#         return 1
#     fi
# }

rebuild_all() {
    echo -e "${YELLOW}[*] Cleaning and rebuilding all modules...${NC}"
    make clean
    make all
    if [ $? -ne 0 ]; then
        echo -e "${RED}[!] Build process failed for one or more modules. Check output above.${NC}"
    else
        echo -e "${GREEN}[V] Build process complete.${NC}"
    fi
    read -p "Press Enter to return..."
}

# --- Main Logic ---

# Check for direct execution arguments
if [ "$#" -gt 0 ]; then
    TOOL_NAME=$1
    shift # Remove the tool name from the arguments
    TOOL_ARGS="${@}"

    case "$TOOL_NAME" in
        pentestzilla) run_pentestzilla $TOOL_ARGS ;;
        pentestzillav4) run_pentestzilla_v4 $TOOL_ARGS ;;
        zillabreath) run_zillabreath $TOOL_ARGS ;;
        # zillatooth) run_zillatooth $TOOL_ARGS ;;
        build) rebuild_all ;;
        *) echo -e "${RED}Unknown tool or command: ${TOOL_NAME}${NC}"; exit 1 ;;
    esac
    exit 0 # Exit after direct execution
fi

# Interactive menu loop
while true; do
    main_menu
    case $choice in
        1) run_pentestzilla ;;
        2) run_pentestzilla_v4 ;;
        3) run_zillabreath ;;
        # 4) run_zillatooth ;;
        4) rebuild_all ;;
        5) echo "Exiting..."; exit 0 ;;
        *) echo -e "${RED}Invalid choice!${NC}"; sleep 1 ;;
    esac
done
