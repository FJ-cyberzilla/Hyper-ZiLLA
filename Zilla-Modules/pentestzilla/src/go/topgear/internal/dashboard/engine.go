package dashboard

import (
    "fmt"
    "time"
    "github.com/fatih/color"
    	"topgear/internal/monitoring")

type MXDashboard struct {
    monitor   *monitoring.MXMonitor
    alerts    []*monitoring.SecurityAlert
    stats     *DashboardStats
}

func NewMXDashboard(monitor *monitoring.MXMonitor) *MXDashboard {
    return &MXDashboard{
        monitor: monitor,
        stats:   &DashboardStats{},
    }
}

func (d *MXDashboard) ShowRealtimeDashboard() {
    for {
        d.clearScreen()
        d.showHeader()
        d.showNetworkOverview()
        d.showDeviceMatrix()
        d.showThreatFeed()
        d.showStatistics()
        d.showAlerts()
        time.Sleep(2 * time.Second)
    }
}

func (d *MXDashboard) showDeviceMatrix() {
    fmt.Println()
    color.New(color.Bold, color.FgCyan).Println("üñ•Ô∏è  DEVICE MATRIX")
    fmt.Println(strings.Repeat("‚îÄ", 100))
    
    // Show devices in a professional matrix view
    fmt.Printf("%-20s %-15s %-12s %-18s %-8s %s\n", 
        "HOSTNAME", "IP", "MAC", "TYPE", "RISK", "STATUS")
    fmt.Println(strings.Repeat("‚îÄ", 100))
    
    for _, device := range d.getCurrentDevices() {
        riskColor := getRiskColor(device.RiskLevel)
        statusIcon := getStatusIcon(device)
        
        fmt.Printf("%-20s %-15s %-12s %-18s ", 
            truncate(device.Hostname, 18),
            getPrimaryIP(device.IPAddresses),
            truncateMAC(device.MACAddress),
            device.DeviceType)
        
        riskColor.Printf("%-8s", device.RiskLevel)
        fmt.Printf(" %s\n", statusIcon)
    }
}

func (d *MXDashboard) showThreatFeed() {
    fmt.Println()
    color.New(color.Bold, color.FgRed).Println("üö® THREAT INTELLIGENCE FEED")
    fmt.Println(strings.Repeat("‚îÄ", 100))
    
    recentAlerts := d.getRecentAlerts(10)
    if len(recentAlerts) == 0 {
        color.New(color.FgGreen).Println("  ‚úÖ No active threats detected")
        return
    }
    
    for _, alert := range recentAlerts {
        d.showAlert(alert)
    }
}
